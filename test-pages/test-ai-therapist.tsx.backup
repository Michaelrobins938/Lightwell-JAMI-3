import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ChevronLeft, ChevronRight, Settings, RefreshCw, Play, Square, ArrowLeft, Sparkles } from 'lucide-react';
import { useRouter } from 'next/router';

// Temporarily remove orb import to fix component issues
import { analyzeEmotionalState, type EmotionalState } from '../lib/emotionalAnalysis';

const TestAITherapist: React.FC = () => {
  const router = useRouter();
  const [testMessage, setTestMessage] = useState('');
  const [emotionalState, setEmotionalState] = useState<EmotionalState>({ state: 'calm', intensity: 5 });
  const [isSpeaking, setIsSpeaking] = useState(false);
  const [isTyping, setIsTyping] = useState(false);
  const [sidebarCollapsed, setSidebarCollapsed] = useState(false);

  const testMessages = [
    "I'm feeling really happy today!",
    "I'm so anxious about my upcoming presentation",
    "I feel really sad and hopeless",
    "I'm so angry at my coworker",
    "I feel vulnerable and scared",
    "I'm feeling creative and inspired",
    "I feel empowered and strong",
    "I'm feeling calm and peaceful"
  ];

  const handleTestMessage = (message: string) => {
    setTestMessage(message);
    const analyzedState = analyzeEmotionalState(message);
    setEmotionalState(analyzedState);
    
    // Simulate speaking
    setIsSpeaking(true);
    setTimeout(() => setIsSpeaking(false), 3000);
  };

  const handleTypingTest = () => {
    setIsTyping(true);
    setTimeout(() => setIsTyping(false), 2000);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-black text-white relative">
      {/* Enhanced background */}
      <div className="absolute inset-0">
        <div className="absolute inset-0 bg-gradient-radial from-blue-500/10 via-purple-500/8 to-transparent" />
        <motion.div 
          className="absolute inset-0 bg-gradient-to-r from-blue-600/5 via-transparent to-purple-600/5"
          animate={{ 
            backgroundPosition: ['0% 50%', '100% 50%', '0% 50%'],
          }}
          transition={{ 
            duration: 20, 
            repeat: Infinity, 
            ease: 'linear' 
          }}
        />
      </div>

      {/* Navigation header */}
      <motion.header 
        className="fixed top-0 left-0 right-0 z-50 backdrop-blur-xl bg-slate-900/30 border-b border-white/10"
        initial={{ y: -100, opacity: 0 }}
        animate={{ y: 0, opacity: 1 }}
        transition={{ duration: 1 }}
      >
        <div className="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
          <div className="flex items-center gap-4">
            <motion.button
              onClick={() => router.push('/meet-jamie')}
              className="p-2 hover:bg-white/10 rounded-lg transition-colors"
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
            >
              <ArrowLeft className="w-5 h-5" />
            </motion.button>
            <motion.div 
              className="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg flex items-center justify-center"
              whileHover={{ scale: 1.1 }}
            >
              <Sparkles className="w-5 h-5" />
            </motion.div>
            <div>
              <h1 className="font-bold text-lg">Jamie Therapy Session</h1>
              <p className="text-xs text-slate-400">AI Therapist Testing Environment</p>
            </div>
          </div>

          {/* Journey progress indicator */}
          <div className="flex items-center gap-2">
            <div className="w-2 h-2 rounded-full bg-blue-400/60"></div>
            <div className="w-2 h-2 rounded-full bg-blue-400/60"></div>
            <div className="w-8 h-2 rounded-full bg-blue-500"></div>
            <span className="text-sm text-slate-400 ml-2">Final Step</span>
          </div>
        </div>
      </motion.header>

      <div className="flex h-screen pt-20 overflow-hidden relative">
      {/* Sidebar */}
      <AnimatePresence>
        {!sidebarCollapsed && (
          <motion.div
            initial={{ x: -300, opacity: 0 }}
            animate={{ x: 0, opacity: 1 }}
            exit={{ x: -300, opacity: 0 }}
            transition={{ duration: 0.3, ease: "easeOut" }}
            className="w-80 md:w-80 sm:w-72 bg-slate-800/90 backdrop-blur-xl border-r border-slate-700/50 flex flex-col shadow-xl max-h-screen overflow-hidden fixed md:relative inset-y-0 left-0 z-40 md:z-auto"
          >
            {/* Sidebar Header */}
            <div className="p-6 border-b border-slate-700/50 bg-gradient-to-r from-blue-500/10 to-purple-500/10">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h2 className="text-xl font-bold text-white">
                    Jamie Testing Lab
                  </h2>
                  <p className="text-xs text-slate-400 mt-1">Emotional State Analysis</p>
                </div>
                <button
                  onClick={() => setSidebarCollapsed(true)}
                  className="p-2 text-slate-400 hover:text-white rounded-lg hover:bg-white/10 transition-all"
                >
                  <ChevronLeft className="w-5 h-5" />
                </button>
              </div>
            </div>

            {/* Test Controls */}
            <div className="flex-1 overflow-y-auto p-4 space-y-6">
              {/* Emotional State Tests */}
              <div>
                <h3 className="text-lg font-medium text-white mb-4">
                  Quick Emotional Tests
                </h3>
                <div className="space-y-2">
                  {testMessages.map((message, index) => (
                    <motion.button
                      key={index}
                      whileHover={{ scale: 1.02 }}
                      whileTap={{ scale: 0.98 }}
                      onClick={() => handleTestMessage(message)}
                      className="w-full p-3 text-sm bg-slate-700/50 text-slate-200 rounded-lg hover:bg-slate-600/50 hover:text-white transition-colors text-left border border-slate-600/30"
                    >
                      {message}
                    </motion.button>
                  ))}
                </div>
              </div>

              {/* Interaction Tests */}
              <div>
                <h3 className="text-lg font-medium text-gray-800 dark:text-gray-200 mb-4">
                  Visual State Controls
                </h3>
                <div className="space-y-3">
                  <motion.button
                    whileHover={{ scale: 1.02 }}
                    whileTap={{ scale: 0.98 }}
                    onClick={() => setIsSpeaking(!isSpeaking)}
                    className={`w-full p-3 rounded-lg transition-colors flex items-center justify-center gap-2 ${
                      isSpeaking 
                        ? 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200' 
                        : 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200'
                    }`}
                  >
                    {isSpeaking ? <Square className="w-4 h-4" /> : <Play className="w-4 h-4" />}
                    {isSpeaking ? 'Stop Speaking' : 'Start Speaking'}
                  </motion.button>
                  
                  <motion.button
                    whileHover={{ scale: 1.02 }}
                    whileTap={{ scale: 0.98 }}
                    onClick={handleTypingTest}
                    className="w-full p-3 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded-lg hover:bg-yellow-200 dark:hover:bg-yellow-800 transition-colors flex items-center justify-center gap-2"
                  >
                    <RefreshCw className="w-4 h-4" />
                    Simulate Typing (2s)
                  </motion.button>
                </div>
              </div>

              {/* Custom Message Input */}
              <div>
                <h3 className="text-lg font-medium text-gray-800 dark:text-gray-200 mb-4">
                  Custom Message Test
                </h3>
                <div className="space-y-3">
                  <textarea
                    value={testMessage}
                    onChange={(e) => setTestMessage(e.target.value)}
                    placeholder="Type a custom message to test emotional analysis..."
                    className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-200"
                    rows={4}
                  />
                  <motion.button
                    whileHover={{ scale: 1.02 }}
                    whileTap={{ scale: 0.98 }}
                    onClick={() => handleTestMessage(testMessage)}
                    className="w-full p-3 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-lg hover:bg-purple-200 dark:hover:bg-purple-800 transition-colors"
                  >
                    Analyze Custom Message
                  </motion.button>
                </div>
              </div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Mobile Overlay */}
      {!sidebarCollapsed && (
        <div 
          className="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"
          onClick={() => setSidebarCollapsed(true)}
        />
      )}

      {/* Sidebar Toggle (when collapsed) */}
      {sidebarCollapsed && (
        <button
          onClick={() => setSidebarCollapsed(false)}
          className="fixed top-4 left-4 z-10 p-2 bg-white dark:bg-gray-800 rounded-lg shadow-md text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white"
        >
          <ChevronRight className="w-5 h-5" />
        </button>
      )}

      {/* Main Content */}
      <div className="flex-1 flex flex-col min-w-0">
        {/* Header */}
        <div className="bg-white/95 dark:bg-gray-800/95 backdrop-blur-lg border-b border-gray-200/50 dark:border-gray-700/50 p-4 shadow-sm">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center">
                <span className="text-white text-sm">üß†</span>
              </div>
              <div>
                <h1 className="text-lg font-semibold text-gray-900 dark:text-white">
                  AI Therapist Orb Test
                </h1>
                <p className="text-xs text-gray-500 dark:text-gray-400">
                  Testing emotional states and visual responses
                </p>
              </div>
            </div>
            
            <div className="flex items-center space-x-2">
              <button className="p-2 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                <Settings className="w-4 h-4" />
              </button>
            </div>
          </div>
        </div>

        {/* Main Content Area */}
        <div className="flex-1 flex">
          {/* Center Content */}
          <div className="flex-1 flex flex-col relative">
            {/* Welcome Hero Section */}
            <div className="flex-1 flex items-center justify-center p-6">
              <div className="max-w-4xl mx-auto text-center">
                <motion.div
                  initial={{ opacity: 0, y: 30 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 1 }}
                >
                  <motion.div 
                    className="inline-flex items-center gap-2 px-4 py-2 bg-emerald-500/10 border border-emerald-500/20 rounded-full text-emerald-300 text-sm font-semibold mb-8"
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    transition={{ duration: 0.8, delay: 0.2 }}
                  >
                    <Sparkles className="w-4 h-4" />
                    Welcome to Your Therapy Session
                  </motion.div>

                  <motion.h1 
                    className="text-4xl md:text-6xl font-black mb-6 tracking-tight"
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 1, delay: 0.4 }}
                  >
                    You've Made It to{' '}
                    <span className="relative inline-block">
                      <span className="bg-gradient-to-r from-blue-400 via-purple-400 to-blue-500 bg-clip-text text-transparent">
                        Jamie
                      </span>
                      <div className="absolute -inset-1 bg-gradient-to-r from-blue-400/20 via-purple-400/20 to-blue-500/20 blur-lg rounded-lg -z-10"></div>
                    </span>
                  </motion.h1>

                  <motion.p 
                    className="text-xl text-slate-300 mb-12 max-w-2xl mx-auto leading-relaxed"
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 1, delay: 0.6 }}
                  >
                    Congratulations! You've completed your journey through Jamie's capabilities. 
                    This is your therapeutic testing environment where you can experience Jamie's 
                    <span className="text-blue-400 font-semibold"> emotional intelligence</span> firsthand.
                  </motion.p>

                  <motion.div 
                    className="bg-slate-800/50 rounded-3xl p-8 backdrop-blur-sm border border-slate-700/50 mb-8"
                    initial={{ opacity: 0, scale: 0.95 }}
                    animate={{ opacity: 1, scale: 1 }}
                    transition={{ duration: 1, delay: 0.8 }}
                  >
                    <h3 className="text-2xl font-bold text-white mb-6">
                      Ready to Experience Jamie's AI Therapy?
                    </h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 text-left">
                      <div className="flex items-start gap-3">
                        <div className="w-8 h-8 bg-blue-500/20 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                          <span className="text-blue-400 font-bold text-sm">1</span>
                        </div>
                        <div>
                          <h4 className="text-white font-semibold mb-1">Test Emotional Analysis</h4>
                          <p className="text-slate-400 text-sm">Use the sidebar to try different emotional states and watch Jamie's orb respond in real-time.</p>
                        </div>
                      </div>
                      
                      <div className="flex items-start gap-3">
                        <div className="w-8 h-8 bg-purple-500/20 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                          <span className="text-purple-400 font-bold text-sm">2</span>
                        </div>
                        <div>
                          <h4 className="text-white font-semibold mb-1">Experience Audio-Reactive Features</h4>
                          <p className="text-slate-400 text-sm">See how Jamie's consciousness visualizes as particles respond to your emotional input.</p>
                        </div>
                      </div>
                      
                      <div className="flex items-start gap-3">
                        <div className="w-8 h-8 bg-emerald-500/20 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                          <span className="text-emerald-400 font-bold text-sm">3</span>
                        </div>
                        <div>
                          <h4 className="text-white font-semibold mb-1">Try Custom Messages</h4>
                          <p className="text-slate-400 text-sm">Write your own messages and see how Jamie's AI analyzes and responds to your unique emotional patterns.</p>
                        </div>
                      </div>
                      
                      <div className="flex items-start gap-3">
                        <div className="w-8 h-8 bg-pink-500/20 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                          <span className="text-pink-400 font-bold text-sm">4</span>
                        </div>
                        <div>
                          <h4 className="text-white font-semibold mb-1">Ready for Real Therapy?</h4>
                          <p className="text-slate-400 text-sm">When ready, move to a full therapy session with persistent memory and comprehensive support.</p>
                        </div>
                      </div>
                    </div>
                  </motion.div>

                  <motion.div 
                    className="flex flex-col sm:flex-row gap-4 justify-center"
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.8, delay: 1.2 }}
                  >
                    <motion.button
                      onClick={() => router.push('/enhanced-chat')}
                      className="px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-500 rounded-2xl font-semibold text-white hover:shadow-xl hover:shadow-blue-500/25 transition-all duration-300 flex items-center gap-3 group relative overflow-hidden"
                      whileHover={{ scale: 1.05 }}
                      whileTap={{ scale: 0.98 }}
                    >
                      <div className="absolute inset-0 bg-gradient-to-r from-blue-400 to-purple-400 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
                      <Sparkles className="w-5 h-5 relative z-10" />
                      <span className="relative z-10">Start Full Therapy Session</span>
                      <ArrowLeft className="w-5 h-5 relative z-10 group-hover:translate-x-1 transition-transform rotate-180" />
                    </motion.button>

                    <motion.button
                      onClick={() => setSidebarCollapsed(false)}
                      className="px-8 py-4 border-2 border-slate-600 text-slate-300 rounded-2xl font-semibold hover:border-blue-500 hover:text-blue-400 hover:bg-blue-500/5 transition-all duration-300 flex items-center gap-3"
                      whileHover={{ scale: 1.05 }}
                      whileTap={{ scale: 0.98 }}
                    >
                      <Play className="w-5 h-5" />
                      <span>Test Jamie's Responses</span>
                    </motion.button>
                  </motion.div>
                </motion.div>

                {/* Orb Display Section */}
                <motion.div
                  initial={{ opacity: 0, scale: 0.8 }}
                  animate={{ opacity: 1, scale: 1 }}
                  transition={{ duration: 1, delay: 1 }}
                  className="bg-slate-800/30 rounded-3xl p-8 backdrop-blur-sm border border-slate-700/30 mt-8"
                >
                  <h3 className="text-2xl font-bold text-white mb-6 text-center">
                    Jamie's Neural Activity Display
                  </h3>
                  
                  {/* Orb Container */}
                  <div className="flex justify-center mb-8">
                    <div className="relative w-80 h-80 bg-gradient-to-br from-gray-100 via-gray-200 to-gray-300 dark:from-gray-700 dark:via-gray-800 dark:to-gray-900 rounded-full mx-auto overflow-hidden border-4 border-purple-200 dark:border-purple-800 shadow-2xl">
                      {/* Placeholder for orb visualization */}
                      <div className="w-full h-full flex items-center justify-center">
                        <motion.div
                          className="w-48 h-48 rounded-full bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500"
                          animate={{ 
                            scale: [1, 1.05, 1],
                            opacity: [0.7, 1, 0.7]
                          }}
                          transition={{ 
                            duration: 2, 
                            repeat: Infinity, 
                            ease: "easeInOut" 
                          }}
                        >
                          <div className="w-full h-full rounded-full bg-gradient-to-tr from-white/20 to-transparent flex items-center justify-center">
                            <Sparkles className="w-16 h-16 text-white/80" />
                          </div>
                        </motion.div>
                      </div>
                      
                      {/* Fallback content */}
                      <div className="absolute inset-0 flex items-center justify-center">
                        <div className="text-gray-600 dark:text-gray-300 text-center opacity-50">
                          <div className="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center shadow-lg">
                            <span className="text-3xl">üß†</span>
                          </div>
                          <div className="text-sm font-medium">Jamie</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* State Display */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="bg-gray-100 dark:bg-gray-700 rounded-2xl p-6">
                      <p className="text-sm text-gray-600 dark:text-gray-400 mb-2">Current Emotional State</p>
                      <p className="text-2xl font-bold text-gray-800 dark:text-gray-200 capitalize">
                        {emotionalState.state}
                      </p>
                      <div className="mt-4">
                        <div className="flex items-center justify-between mb-2">
                          <span className="text-sm text-gray-600 dark:text-gray-400">Intensity</span>
                          <span className="text-sm font-medium text-gray-900 dark:text-white">
                            {emotionalState.intensity}/10
                          </span>
                        </div>
                        <div className="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                          <motion.div 
                            className="bg-gradient-to-r from-purple-500 to-blue-500 h-3 rounded-full"
                            initial={{ width: 0 }}
                            animate={{ width: `${(emotionalState.intensity / 10) * 100}%` }}
                            transition={{ duration: 0.5 }}
                          />
                        </div>
                      </div>
                    </div>
                    
                    <div className="bg-gray-100 dark:bg-gray-700 rounded-2xl p-6">
                      <p className="text-sm text-gray-600 dark:text-gray-400 mb-2">Current Test Message</p>
                      <p className="text-sm text-gray-800 dark:text-gray-200 min-h-[60px] p-3 bg-white dark:bg-gray-600 rounded-lg">
                        {testMessage || 'No message selected. Choose a test message from the sidebar.'}
                      </p>
                      
                      {/* Visual Status */}
                      <div className="mt-4 flex flex-wrap gap-2">
                        {isSpeaking && (
                          <span className="px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400 text-xs rounded-full flex items-center gap-1">
                            üîä Speaking
                          </span>
                        )}
                        {isTyping && (
                          <span className="px-2 py-1 bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400 text-xs rounded-full flex items-center gap-1">
                            ‚å®Ô∏è Typing
                          </span>
                        )}
                      </div>
                    </div>
                  </div>
                </motion.div>
              </div>
            </div>

            {/* How It Works Section */}
            <div className="border-t border-gray-200/50 dark:border-gray-700/50 bg-white/95 dark:bg-gray-800/95 backdrop-blur-lg p-6">
              <div className="max-w-4xl mx-auto">
                <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 text-center">
                  How It Works
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div className="text-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-xl">
                    <div className="text-2xl mb-2">üé≠</div>
                    <h4 className="text-sm font-medium text-gray-800 dark:text-gray-200 mb-2">
                      Emotional Analysis
                    </h4>
                    <p className="text-xs text-gray-600 dark:text-gray-400">
                      AI analyzes text to detect emotional states and intensity levels
                    </p>
                  </div>
                  <div className="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl">
                    <div className="text-2xl mb-2">üåü</div>
                    <h4 className="text-sm font-medium text-gray-800 dark:text-gray-200 mb-2">
                      Visual Response
                    </h4>
                    <p className="text-xs text-gray-600 dark:text-gray-400">
                      Orb appearance changes based on emotional state and intensity
                    </p>
                  </div>
                  <div className="text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-xl">
                    <div className="text-2xl mb-2">üîä</div>
                    <h4 className="text-sm font-medium text-gray-800 dark:text-gray-200 mb-2">
                      Audio Integration
                    </h4>
                    <p className="text-xs text-gray-600 dark:text-gray-400">
                      Responds to speech synthesis with audio-reactive effects
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default TestAITherapist; 